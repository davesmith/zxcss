<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>ZXCSS</title>

<style type="text/css">
input[type=number], input[type=text], textarea {display:block;}
textarea {width:90%;}
</style>

<style>
.col {float:left;width:100%;}
.clear {clear:left;}
.noclear {clear:none;}
</style>
<style class="classestest"></style>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script type="text/javascript">

(function(context){
    
    // Config
    var getInput 
    ,   initialise
    ,   app = {els:{}}
    ;
        
    // Actions
    getElements = function() {
        app.els.numberOfColumnsInput = $('#input-numberofcolumns');
        app.els.numberOfBreakPointsInput = $('#input-numberofbreakpoints');
        app.els.decimalPlaces = $('#input-decimalplaces');
        app.els.output = $('.output');
        app.els.outputLabelSpan = $('label[for=output] span');
        app.els.minify = $('#input-minify');
        app.els.widthClasses = $('#input-widthclasses');
        app.els.positionClasses = $('#input-positionclasses');
        app.els.styleClassesTest = $('.classestest');
    };
    getInput = function() {
        app.numberOfColumns = app.els.numberOfColumnsInput.val();
        app.numberOfBreakPoints = app.els.numberOfBreakPointsInput.val().split(',');
        app.numberOfBreakPointsLength = app.numberOfBreakPoints.length;
        app.decimalPlaces = app.els.decimalPlaces.val();
        app.minify = app.els.minify[0].checked;
        app.widthClasses = app.els.widthClasses[0].checked;
        app.positionClasses = app.els.positionClasses[0].checked;
    };
    createCSS = function() {
        
        var i = 1
        ,   b
        ,   bp
        ,   j
        ,   width
        ,   widths = {}
        ,   widthsi
        ,   position
        ,   positions = {}
        ,   positionsi
        ,   css = ''
        ;
        
        for (b = 0; b < app.numberOfBreakPointsLength; b++) {
            
            bp = b+1;
            css += '@media all and (min-width:'+app.numberOfBreakPoints[b]+'px)'+app.space+'{'+app.newline;
        
            // clear and no clear
            css += '.clear-b'+bp+app.space+'{clear:left;}'+app.newline;
            css += '.noclear-b'+bp+app.space+'{clear:none;}'+app.newline;
            
            // Create an object where the properties are widths and the values are an array of objects with numerators and denominators
            for (i; i < app.numberOfColumns; i++) {
                j = 1;
                for (j; j < app.numberOfColumns; j++) {
                    if (app.widthClasses) {
                        width = applyDecimalPlaces(100*i/j, app.decimalPlaces);
                        if (width <= 100) {
                            if (!widths[width]) {
                                widths[width] = [];
                            }
                            widths[width].push({numerator:i, denominator:j});
                        }
                    }
                    if (app.positionClasses) {
                        position = applyDecimalPlaces(100*(i-1)/j, app.decimalPlaces);
                        if (position < 100) {
                            if (!positions[position]) {
                                positions[position] = [];
                            }
                            positions[position].push({numerator:i, denominator:j});
                        }
                    }
                }
            }
            
            
            
            // Create the widths classes
            if (app.widthClasses) {
                notFirst = false;
                for (i in widths) {
                    if (widths.hasOwnProperty(i)) {
                        if (notFirst) {
                            css += app.newline;
                        }
                        else {
                            notFirst = true;
                        }
                        widthsi = widths[i];
                        
                        for (j = 0; j < widthsi.length; j++) {
                            if (j > 0) {
                                css += ','+app.space;
                            }
                            css += '.w'+widthsi[j].numerator+'o'+widthsi[j].denominator+'-b'+bp;
                        }
                    
                        css += app.space+'{width:'+i+'%'+app.semicolon+'}';
                    }
                }
                css += app.newline;
            }
            
            // Create the position classes
            if (app.positionClasses) {
                notFirst = false;
                for (i in positions) {
                    if (positions.hasOwnProperty(i)) {
                        if (notFirst) {
                            css += app.newline;
                            }
                        else {
                            notFirst = true;
                        }
                        positionsi = positions[i];
                        for (j = 0; j < positionsi.length; j++) {
                            if (j > 0) {
                                css += ','+app.space;
                            }
                            css += '.p'+positionsi[j].numerator+'o'+positionsi[j].denominator+'-b'+bp;
                        }
                    
                        css += app.space+'{margin-left:'+i+'%'+app.semicolon+'}';
                    }
                }
                css += app.newline;
                for (i = 1; i < app.numberOfColumns; i++) {
                    for (j = 1; j < app.numberOfColumns; j++) {
                        if ((i-1)/j < 1) {
                            if (j > 1) {
                                css += ','+app.space;
                            }
                            css += '.p'+i+'o'+j+'-b'+bp;
                        }
                    }
                }
                css += app.space+'{margin-right:-100%'+app.semicolon+'}';
            }
            
            css += app.newline + '}';
            
        }
        
        app.cssLength = css.length;
        
        resizeOutput();
        
        app.css = css;
        
    };
    
    resizeOutput = function() {
        app.els.output[0].style.height = "1px";
        setTimeout(function() {
            app.els.output[0].style.height = (app.els.output[0].scrollHeight)+"px";
        }, 1);
    };
    
    applyDecimalPlaces = function(num, decimalPlaces) {
        var scaler = Math.pow(10, decimalPlaces);
        return Math.floor(num * scaler)/scaler;
    };
    
    outputCSS = function() {
        app.els.output.val(app.css);
        app.els.output[0].rows = app.cssLines;
        app.els.outputLabelSpan.html(' '+app.cssLength);
        app.els.styleClassesTest.html(app.css);
    };
    
    run = function() {
        
        getInput();
        app.space = ' ';
        app.newline = "\n";
        app.semicolon = ';';
        if (app.minify) {
            app.space = '';
            app.newline = '';
            app.semicolon = '';
        }
        createCSS();
        outputCSS();
        
    };
    
    inputChange = function() {
        run();
    };
    
    // Event logic
    // On Dom Ready
    $(function() {
    
        getElements();
        run();
        
        // On change of various inputs
        app.els.numberOfColumnsInput.on('change', inputChange);
        app.els.numberOfBreakPointsInput.on('change', inputChange);
        app.els.decimalPlaces.on('change', inputChange);
        app.els.minify.on('change', inputChange);
        app.els.widthClasses.on('change', inputChange);
        app.els.positionClasses.on('change', inputChange);
        
    });


}(this));
    

</script>

</head>

<body>

<h1><a href="http://www.dave-smith.info/zxcss-layout/">ZXCSS</a></h1>
<p>
<label for="input-numberofcolumns">Columns</label>
<input name="input-numberofcolumns" id="input-numberofcolumns" type="number" value="12" />

<label for="input-numberofbreakpoints">Breakpoints</label>
<input name="input-numberofbreakpoints" id="input-numberofbreakpoints" type="text" value="768,1024" />

<label for="input-decimalplaces">Decimal places</label>
<input name="input-decimalplaces" id="input-decimalplaces" type="number" value="4" />
</p>
<p>
<input name="input-widthclasses" id="input-widthclasses" type="checkbox" checked="checked" />
<label for="input-widthclasses">Width classes</label>

<input name="input-positionclasses" id="input-positionclasses" type="checkbox" checked="checked" />
<label for="input-positionclasses">Position classes</label>

<input name="input-minify" id="input-minify" type="checkbox" checked="checked" />
<label for="input-minify">Minify</label>
</p>

<div class="clear"></div>
<div class="col w1o3-b1 w1o4-b2 p4o4-b2">a</div>
<div class="col w2o3-b1 w2o4-b2 p2o4-b2">b</div>
<div class="clear noclear-b2"></div>
<div class="col w1o4-b2 p1o4-b2">c</div>
<div class="clear"></div>

<p>
<label for="output">Output<span></span></label>
<textarea class="output" id="output" cols="60" rows="10"></textarea>
</p>

bp0 0+    every column is width 100% except fixed width gutter column layouts
bp1 768+  column layouts applied, widths needed
bp2 1024+ full column layouts

layoutmastercss
col inn clear
lay-col
lay-inn
lay-clr
<style>
.lm-col {width:100%;float:left;}
.lm-clear {clear:left;}
@media all and (min-width:768px) {
    .lm-w1o3-b1 {width:33.3333%;}
    .lm-w2o3-b1 {width:66.6666%;}
}
@media all and (min-width:1024px) {
    .lm-w1o4-b2 {width:25%;}
    .lm-w2o4-b2 {width:50%;}
    .lm-noclear-b2 {clear:none;}
    .lm-p1o4-b2 {margin-left:0;margin-right:-100%;}
    .lm-p2o4-b2 {margin-left:25%;margin-right:-100%;}
    .lm-p4o4-b2 {margin-left:75%;margin-right:-100%;}
}
</style>
<div class="lm-clear"></div>
<div class="lm-col lm-w1o3-b1 lm-w1o4-b2 lm-p4o4-b2">a</div>
<div class="lm-col lm-w2o3-b1 lm-w2o4-b2 lm-p2o4-b2">b</div>
<div class="lm-clear lm-noclear-b2"></div>
<div class="lm-col lm-w1o4-b2 lm-p1o4-b2">c</div>
<div class="lm-clear"></div>





</body>
</html>
